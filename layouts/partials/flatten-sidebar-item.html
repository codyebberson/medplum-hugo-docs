{{ $item := . }}
{{ $pages := slice }}

{{ if eq $item.type "doc" }}
  {{ with site.GetPage $item.id }}
    {{ $pages = $pages | append . }}
  {{ end }}

{{ else if eq $item.type "category" }}
  {{ with site.GetPage $item.id }}
    {{ $pages = $pages | append . }}
  {{ end }}
  {{ range $item.items }}
    {{ range partial "flatten-sidebar-item" . }}
      {{ $pages = $pages | append . }}
    {{ end }}
  {{ end }}
  {{ if $item.autogenerated }}
    {{ with site.GetPage $item.id }}
      {{ range .RegularPages.ByWeight }}
        {{ $pages = $pages | append . }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{ return $pages }}
